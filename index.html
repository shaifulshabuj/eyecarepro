<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#2c3e50">
    <meta name="description" content="Eye Care PWA - Your digital eye health companion">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>EyeCare Pro - Eye Health Companion</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --danger: #e74c3c;
            --dark: #2c3e50;
            --light: #ecf0f1;
            --shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
            text-align: center;
            position: relative;
        }

        .language-selector {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            min-width: 80px;
        }

        .language-dropdown {
            display: none;
            position: absolute;
            top: 50px;
            right: 15px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.15);
            overflow: hidden;
            z-index: 100;
        }

        .language-dropdown.show {
            display: block;
        }

        .language-option {
            padding: 12px 20px;
            cursor: pointer;
            transition: background 0.3s;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .language-option:hover {
            background: var(--light);
        }

        .language-option.active {
            background: var(--primary);
            color: white;
        }

        .flag {
            font-size: 20px;
        }

        .header h1 {
            color: var(--dark);
            font-size: 28px;
            margin-bottom: 10px;
            margin-top: 30px;
        }

        .header .subtitle {
            color: #7f8c8d;
            font-size: 14px;
        }

        .status-indicator {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin-top: 10px;
            background: #e8f5e9;
            color: #2e7d32;
        }

        .nav-tabs {
            display: flex;
            background: white;
            border-radius: 15px;
            padding: 5px;
            margin-bottom: 20px;
            box-shadow: var(--shadow);
        }

        .nav-tab {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: #7f8c8d;
            font-size: 14px;
            cursor: pointer;
            border-radius: 10px;
            transition: all 0.3s;
            font-weight: 500;
        }

        .nav-tab.active {
            background: var(--primary);
            color: white;
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
        }

        .card-title {
            font-size: 18px;
            color: var(--dark);
            margin-bottom: 15px;
            font-weight: 600;
        }

        .exercise-item {
            padding: 15px;
            background: var(--light);
            border-radius: 10px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .exercise-item:hover {
            transform: translateX(5px);
            background: #d5dbdd;
        }

        .exercise-title {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 5px;
        }

        .exercise-desc {
            font-size: 14px;
            color: #7f8c8d;
            line-height: 1.4;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--secondary);
            color: white;
        }

        .btn-danger {
            background: var(--danger);
            color: white;
        }

        .timer-display {
            font-size: 48px;
            font-weight: bold;
            color: var(--primary);
            text-align: center;
            margin: 20px 0;
        }

        .vision-test-area {
            text-align: center;
            padding: 40px 20px;
            background: #f8f9fa;
            border-radius: 10px;
            margin: 20px 0;
        }

        .test-letter {
            font-size: 60px;
            font-weight: bold;
            color: var(--dark);
            letter-spacing: 10px;
        }

        .reminder-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: var(--light);
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .reminder-info {
            flex: 1;
        }

        .reminder-time {
            font-weight: 600;
            color: var(--dark);
        }

        .reminder-text {
            font-size: 14px;
            color: #7f8c8d;
            margin-top: 5px;
        }

        .delete-btn {
            background: var(--danger);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 14px;
        }

        .tips-list {
            list-style: none;
        }

        .tips-list li {
            padding: 12px;
            margin-bottom: 10px;
            background: var(--light);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            line-height: 1.5;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 400px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            float: right;
            font-size: 24px;
            cursor: pointer;
            color: #7f8c8d;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: var(--dark);
        }

        .form-group input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .install-banner {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
            display: none;
        }

        .install-banner.show {
            display: block;
        }

        .install-btn {
            background: white;
            color: #667eea;
            padding: 8px 16px;
            border-radius: 20px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            margin-top: 10px;
        }

        /* Support for Bengali/Japanese fonts */
        .bn, .ja {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans Bengali', 'Noto Sans JP', sans-serif;
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .nav-tab {
                font-size: 12px;
                padding: 10px 5px;
            }

            .language-selector {
                font-size: 12px;
                padding: 6px 10px;
            }
        }

        /* PWA-specific styles */
        @media (display-mode: standalone) {
            .header {
                background: linear-gradient(135deg, #667eea, #764ba2);
                color: white;
            }
            
            .header h1, .header .subtitle {
                color: white;
            }
            
            .status-indicator {
                background: rgba(255,255,255,0.2);
                color: white;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="language-selector" onclick="toggleLanguageDropdown()" id="langButton">EN 🇺🇸</button>
            <div class="language-dropdown" id="languageDropdown">
                <div class="language-option active" onclick="changeLanguage('en')">
                    <span class="flag">🇺🇸</span> English
                </div>
                <div class="language-option" onclick="changeLanguage('ja')">
                    <span class="flag">🇯🇵</span> 日本語
                </div>
                <div class="language-option" onclick="changeLanguage('bn')">
                    <span class="flag">🇧🇩</span> বাংলা
                </div>
                <div class="language-option" onclick="changeLanguage('id')">
                    <span class="flag">🇮🇩</span> Bahasa Indonesia
                </div>
            </div>
            <h1 id="appTitle">👁️ EyeCare Pro</h1>
            <p class="subtitle" id="appSubtitle">Your Digital Eye Health Companion</p>
            <span class="status-indicator" id="appStatus">Online</span>
        </div>

        <div id="installBanner" class="install-banner">
            <p id="installText">📱 Install EyeCare Pro for the best experience!</p>
            <button class="install-btn" onclick="promptInstall()" id="installButton">Install App</button>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('exercises', event)" id="tabExercises">Exercises</button>
            <button class="nav-tab" onclick="switchTab('tests', event)" id="tabTests">Tests</button>
            <button class="nav-tab" onclick="switchTab('reminders', event)" id="tabReminders">Reminders</button>
            <button class="nav-tab" onclick="switchTab('tips', event)" id="tabTips">Tips</button>
        </div>

        <!-- Exercises Section -->
        <div id="exercises" class="content-section active">
            <div class="card">
                <h2 class="card-title" id="exercisesTitle">Eye Exercises</h2>
                <div id="exercisesList"></div>
            </div>
        </div>

        <!-- Tests Section -->
        <div id="tests" class="content-section">
            <div class="card">
                <h2 class="card-title" id="testsTitle">Vision Tests</h2>
                
                <button class="btn btn-primary" onclick="startVisionTest('snellen')" id="snellenBtn">
                    Snellen Chart Test
                </button>
                
                <button class="btn btn-primary" onclick="startVisionTest('color')" id="colorBtn">
                    Color Blindness Test
                </button>
                
                <button class="btn btn-primary" onclick="startVisionTest('astigmatism')" id="astigmatismBtn">
                    Astigmatism Test
                </button>

                <div id="test-area" class="vision-test-area" style="display: none;">
                    <div id="test-content"></div>
                </div>
            </div>
        </div>

        <!-- Reminders Section -->
        <div id="reminders" class="content-section">
            <div class="card">
                <h2 class="card-title" id="remindersTitle">Eye Care Reminders</h2>
                
                <button class="btn btn-success" onclick="showReminderModal()" id="addReminderBtn">
                    + Add New Reminder
                </button>

                <div id="reminders-list">
                    <p style="text-align: center; color: #7f8c8d;" id="noRemindersText">No reminders set</p>
                </div>
            </div>
        </div>

        <!-- Tips Section -->
        <div id="tips" class="content-section">
            <div class="card">
                <h2 class="card-title" id="tipsTitle">Eye Health Tips</h2>
                <ul class="tips-list" id="tipsList"></ul>
            </div>
        </div>
    </div>

    <!-- Exercise Modal -->
    <div id="exerciseModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeExerciseModal()">×</span>
            <h2 id="exercise-title"></h2>
            <div id="exercise-instructions"></div>
            <div id="timer" class="timer-display">00:00</div>
            <button id="exercise-btn" class="btn btn-primary" onclick="toggleExercise()">Start</button>
        </div>
    </div>

    <!-- Reminder Modal -->
    <div id="reminderModal" class="modal">
        <div class="modal-content">
            <span class="close-modal" onclick="closeReminderModal()">×</span>
            <h2 id="reminderModalTitle">Add Reminder</h2>
            <div class="form-group">
                <label id="reminderTypeLabel">Reminder Type</label>
                <input type="text" id="reminder-type" placeholder="e.g., Eye drops, Break, Exercise">
            </div>
            <div class="form-group">
                <label id="reminderTimeLabel">Time</label>
                <input type="time" id="reminder-time">
            </div>
            <div class="form-group">
                <label>
                    <input type="checkbox" id="reminder-repeat"> <span id="repeatDailyLabel">Repeat Daily</span>
                </label>
            </div>
            <button class="btn btn-success" onclick="addReminder()" id="addReminderModalBtn">Add Reminder</button>
        </div>
    </div>

    <script>
        // Translation data
        const translations = {
            en: {
                code: 'EN 🇺🇸',
                appTitle: '👁️ EyeCare Pro',
                appSubtitle: 'Your Digital Eye Health Companion',
                online: 'Online',
                offline: 'Offline',
                installText: '📱 Install EyeCare Pro for the best experience!',
                installButton: 'Install App',
                tabExercises: 'Exercises',
                tabTests: 'Tests',
                tabReminders: 'Reminders',
                tabTips: 'Tips',
                exercisesTitle: 'Eye Exercises',
                testsTitle: 'Vision Tests',
                remindersTitle: 'Eye Care Reminders',
                tipsTitle: 'Eye Health Tips',
                addReminderBtn: '+ Add New Reminder',
                noRemindersText: 'No reminders set',
                snellenBtn: 'Snellen Chart Test',
                colorBtn: 'Color Blindness Test',
                astigmatismBtn: 'Astigmatism Test',
                reminderModalTitle: 'Add Reminder',
                reminderTypeLabel: 'Reminder Type',
                reminderTimeLabel: 'Time',
                repeatDailyLabel: 'Repeat Daily',
                addReminderModalBtn: 'Add Reminder',
                deleteBtn: 'Delete',
                startBtn: 'Start',
                stopBtn: 'Stop',
                completeBtn: 'Complete!',
                nextBtn: 'Next Letter',
                checkBtn: 'Check',
                doneBtn: 'Done',
                daily: 'Daily',
                exercises: {
                    '20-20-20': {
                        title: '20-20-20 Rule',
                        desc: 'Every 20 minutes, look at something 20 feet away for 20 seconds',
                        instructions: 'Look at an object 20 feet away for 20 seconds. This helps reduce eye strain from prolonged screen time.'
                    },
                    'palming': {
                        title: 'Palming',
                        desc: 'Relax your eyes with gentle palm coverage',
                        instructions: 'Rub your palms together to warm them, then gently cup them over your closed eyes. Relax for 30 seconds.'
                    },
                    'blinking': {
                        title: 'Blinking Exercise',
                        desc: 'Conscious blinking to moisturize eyes',
                        instructions: 'Blink slowly and deliberately 20 times. This helps moisturize your eyes naturally.'
                    },
                    'focus-shift': {
                        title: 'Focus Shifting',
                        desc: 'Alternate focus between near and far objects',
                        instructions: 'Hold your thumb 10 inches away. Focus on it for 5 seconds, then shift focus to something 20 feet away for 5 seconds. Repeat 5 times.'
                    },
                    'eye-rolling': {
                        title: 'Eye Rolling',
                        desc: 'Circular eye movements for flexibility',
                        instructions: 'Look up and slowly roll your eyes in a clockwise circle 5 times, then counter-clockwise 5 times.'
                    }
                },
                tips: [
                    '💧 Keep your eyes hydrated by blinking regularly',
                    '🖥️ Maintain 20-24 inches distance from screens',
                    '💡 Ensure proper lighting to avoid eye strain',
                    '🥗 Eat foods rich in Vitamin A and Omega-3',
                    '😴 Get 7-8 hours of quality sleep',
                    '🕶️ Wear UV-protective sunglasses outdoors',
                    '💻 Adjust screen brightness to match surroundings',
                    '🚭 Avoid smoking - it damages eye blood vessels',
                    '💊 Consider omega-3 supplements for dry eyes',
                    '👩‍⚕️ Get regular eye check-ups annually'
                ],
                testInstructions: {
                    snellen: 'Cover one eye and identify the direction of the E',
                    color: 'What color do you see?',
                    astigmatism: 'Do all lines appear equally dark and clear?',
                    colorAlert: 'This is a basic screening. For accurate results, consult an eye care professional.',
                    astigmatismAlert: 'If lines appear different, consult an eye care professional.'
                },
                alerts: {
                    fillFields: 'Please fill in all fields',
                    exerciseComplete: 'Exercise Complete! 🎉',
                    greatJob: 'Great job taking care of your eyes!',
                    notificationTitle: 'Eye Care Reminder'
                }
            },
            ja: {
                code: 'JA 🇯🇵',
                appTitle: '👁️ アイケアプロ',
                appSubtitle: 'デジタル眼の健康コンパニオン',
                online: 'オンライン',
                offline: 'オフライン',
                installText: '📱 最高の体験のためアイケアプロをインストール！',
                installButton: 'アプリをインストール',
                tabExercises: 'エクササイズ',
                tabTests: 'テスト',
                tabReminders: 'リマインダー',
                tabTips: 'ヒント',
                exercisesTitle: '目のエクササイズ',
                testsTitle: '視力検査',
                remindersTitle: 'アイケアリマインダー',
                tipsTitle: '目の健康のヒント',
                addReminderBtn: '+ 新しいリマインダーを追加',
                noRemindersText: 'リマインダーが設定されていません',
                snellenBtn: 'スネレン視力検査',
                colorBtn: '色覚異常検査',
                astigmatismBtn: '乱視検査',
                reminderModalTitle: 'リマインダーを追加',
                reminderTypeLabel: 'リマインダーの種類',
                reminderTimeLabel: '時間',
                repeatDailyLabel: '毎日繰り返す',
                addReminderModalBtn: 'リマインダーを追加',
                deleteBtn: '削除',
                startBtn: '開始',
                stopBtn: '停止',
                completeBtn: '完了！',
                nextBtn: '次の文字',
                checkBtn: 'チェック',
                doneBtn: '完了',
                daily: '毎日',
                exercises: {
                    '20-20-20': {
                        title: '20-20-20ルール',
                        desc: '20分ごとに、20フィート離れたものを20秒間見る',
                        instructions: '20フィート離れた物体を20秒間見てください。これは長時間の画面使用による眼精疲労を軽減します。'
                    },
                    'palming': {
                        title: 'パーミング',
                        desc: '優しく手のひらで目を覆ってリラックス',
                        instructions: '手のひらをこすり合わせて温め、閉じた目の上に優しくかぶせます。30秒間リラックスしてください。'
                    },
                    'blinking': {
                        title: 'まばたきエクササイズ',
                        desc: '意識的なまばたきで目を潤す',
                        instructions: 'ゆっくりと意識的に20回まばたきをしてください。これは自然に目を潤すのに役立ちます。'
                    },
                    'focus-shift': {
                        title: 'フォーカスシフト',
                        desc: '近くと遠くの物体に交互に焦点を合わせる',
                        instructions: '親指を10インチ離して持ちます。5秒間焦点を合わせ、次に20フィート離れたものに5秒間焦点を移します。5回繰り返します。'
                    },
                    'eye-rolling': {
                        title: 'アイローリング',
                        desc: '柔軟性のための円形の目の動き',
                        instructions: '上を見て、ゆっくりと時計回りに5回、次に反時計回りに5回目を回してください。'
                    }
                },
                tips: [
                    '💧 定期的にまばたきをして目を潤す',
                    '🖥️ 画面から20〜24インチの距離を保つ',
                    '💡 眼精疲労を避けるため適切な照明を確保',
                    '🥗 ビタミンAとオメガ3が豊富な食品を食べる',
                    '😴 7〜8時間の質の良い睡眠をとる',
                    '🕶️ 屋外ではUVカットサングラスを着用',
                    '💻 画面の明るさを周囲に合わせて調整',
                    '🚭 喫煙を避ける - 目の血管を傷つける',
                    '💊 ドライアイにはオメガ3サプリメントを検討',
                    '👩‍⚕️ 年に一度定期的な眼科検診を受ける'
                ],
                testInstructions: {
                    snellen: '片目を覆い、Eの方向を識別してください',
                    color: '何色が見えますか？',
                    astigmatism: 'すべての線が同じように暗くはっきり見えますか？',
                    colorAlert: 'これは基本的なスクリーニングです。正確な結果については、眼科専門医にご相談ください。',
                    astigmatismAlert: '線が異なって見える場合は、眼科専門医にご相談ください。'
                },
                alerts: {
                    fillFields: 'すべてのフィールドに入力してください',
                    exerciseComplete: 'エクササイズ完了！🎉',
                    greatJob: '目のケアをよく頑張りました！',
                    notificationTitle: 'アイケアリマインダー'
                }
            },
            bn: {
                code: 'BN 🇧🇩',
                appTitle: '👁️ আইকেয়ার প্রো',
                appSubtitle: 'আপনার ডিজিটাল চোখের স্বাস্থ্য সঙ্গী',
                online: 'অনলাইন',
                offline: 'অফলাইন',
                installText: '📱 সেরা অভিজ্ঞতার জন্য আইকেয়ার প্রো ইনস্টল করুন!',
                installButton: 'অ্যাপ ইনস্টল করুন',
                tabExercises: 'ব্যায়াম',
                tabTests: 'পরীক্ষা',
                tabReminders: 'রিমাইন্ডার',
                tabTips: 'টিপস',
                exercisesTitle: 'চোখের ব্যায়াম',
                testsTitle: 'দৃষ্টি পরীক্ষা',
                remindersTitle: 'আই কেয়ার রিমাইন্ডার',
                tipsTitle: 'চোখের স্বাস্থ্য টিপস',
                addReminderBtn: '+ নতুন রিমাইন্ডার যোগ করুন',
                noRemindersText: 'কোন রিমাইন্ডার সেট করা নেই',
                snellenBtn: 'স্নেলেন চার্ট পরীক্ষা',
                colorBtn: 'বর্ণান্ধতা পরীক্ষা',
                astigmatismBtn: 'অ্যাস্টিগম্যাটিজম পরীক্ষা',
                reminderModalTitle: 'রিমাইন্ডার যোগ করুন',
                reminderTypeLabel: 'রিমাইন্ডারের ধরন',
                reminderTimeLabel: 'সময়',
                repeatDailyLabel: 'প্রতিদিন পুনরাবৃত্তি',
                addReminderModalBtn: 'রিমাইন্ডার যোগ করুন',
                deleteBtn: 'মুছুন',
                startBtn: 'শুরু',
                stopBtn: 'থামুন',
                completeBtn: 'সম্পূর্ণ!',
                nextBtn: 'পরবর্তী অক্ষর',
                checkBtn: 'চেক করুন',
                doneBtn: 'সম্পন্ন',
                daily: 'প্রতিদিন',
                exercises: {
                    '20-20-20': {
                        title: '২০-২০-২০ নিয়ম',
                        desc: 'প্রতি ২০ মিনিটে, ২০ ফুট দূরে কিছু ২০ সেকেন্ড দেখুন',
                        instructions: '২০ ফুট দূরে একটি বস্তু ২০ সেকেন্ডের জন্য দেখুন। এটি দীর্ঘ স্ক্রিন সময় থেকে চোখের চাপ কমাতে সাহায্য করে।'
                    },
                    'palming': {
                        title: 'পামিং',
                        desc: 'মৃদু হাতের তালু দিয়ে চোখ শিথিল করুন',
                        instructions: 'আপনার হাতের তালু একসাথে ঘষে গরম করুন, তারপর বন্ধ চোখের উপর মৃদুভাবে রাখুন। ৩০ সেকেন্ড শিথিল করুন।'
                    },
                    'blinking': {
                        title: 'পলক ফেলার ব্যায়াম',
                        desc: 'চোখ আর্দ্র করতে সচেতন পলক ফেলা',
                        instructions: 'ধীরে ধীরে এবং ইচ্ছাকৃতভাবে ২০ বার পলক ফেলুন। এটি প্রাকৃতিকভাবে আপনার চোখ আর্দ্র করতে সাহায্য করে।'
                    },
                    'focus-shift': {
                        title: 'ফোকাস শিফটিং',
                        desc: 'কাছের এবং দূরের বস্তুর মধ্যে পর্যায়ক্রমে ফোকাস',
                        instructions: 'আপনার বুড়ো আঙুল ১০ ইঞ্চি দূরে ধরুন। ৫ সেকেন্ড ফোকাস করুন, তারপর ২০ ফুট দূরে কিছুতে ৫ সেকেন্ড ফোকাস করুন। ৫ বার পুনরাবৃত্তি করুন।'
                    },
                    'eye-rolling': {
                        title: 'চোখ ঘোরানো',
                        desc: 'নমনীয়তার জন্য বৃত্তাকার চোখের নড়াচড়া',
                        instructions: 'উপরে তাকান এবং ধীরে ধীরে ঘড়ির কাঁটার দিকে ৫ বার চোখ ঘোরান, তারপর বিপরীত দিকে ৫ বার।'
                    }
                },
                tips: [
                    '💧 নিয়মিত পলক ফেলে চোখ আর্দ্র রাখুন',
                    '🖥️ স্ক্রিন থেকে ২০-২৪ ইঞ্চি দূরত্ব বজায় রাখুন',
                    '💡 চোখের চাপ এড়াতে সঠিক আলো নিশ্চিত করুন',
                    '🥗 ভিটামিন এ এবং ওমেগা-৩ সমৃদ্ধ খাবার খান',
                    '😴 ৭-৮ ঘণ্টা মানসম্পন্ন ঘুম পান',
                    '🕶️ বাইরে ইউভি-প্রতিরক্ষামূলক সানগ্লাস পরুন',
                    '💻 পরিবেশের সাথে মিল রেখে স্ক্রিনের উজ্জ্বলতা সামঞ্জস্য করুন',
                    '🚭 ধূমপান এড়িয়ে চলুন - এটি চোখের রক্তনালী ক্ষতিগ্রস্ত করে',
                    '💊 শুষ্ক চোখের জন্য ওমেগা-৩ সাপ্লিমেন্ট বিবেচনা করুন',
                    '👩‍⚕️ বছরে একবার নিয়মিত চোখ পরীক্ষা করান'
                ],
                testInstructions: {
                    snellen: 'এক চোখ ঢেকে E এর দিক চিহ্নিত করুন',
                    color: 'আপনি কি রঙ দেখছেন?',
                    astigmatism: 'সব লাইন কি সমানভাবে গাঢ় এবং পরিষ্কার দেখাচ্ছে?',
                    colorAlert: 'এটি একটি প্রাথমিক পরীক্ষা। সঠিক ফলাফলের জন্য, চক্ষু বিশেষজ্ঞের পরামর্শ নিন।',
                    astigmatismAlert: 'লাইনগুলি ভিন্ন দেখালে, চক্ষু বিশেষজ্ঞের পরামর্শ নিন।'
                },
                alerts: {
                    fillFields: 'সব ক্ষেত্র পূরণ করুন',
                    exerciseComplete: 'ব্যায়াম সম্পূর্ণ! 🎉',
                    greatJob: 'চোখের যত্ন নেওয়ার জন্য দুর্দান্ত কাজ!',
                    notificationTitle: 'আই কেয়ার রিমাইন্ডার'
                }
            },
            id: {
                code: 'ID 🇮🇩',
                appTitle: '👁️ EyeCare Pro',
                appSubtitle: 'Pendamping Kesehatan Mata Digital Anda',
                online: 'Online',
                offline: 'Offline',
                installText: '📱 Instal EyeCare Pro untuk pengalaman terbaik!',
                installButton: 'Instal Aplikasi',
                tabExercises: 'Latihan',
                tabTests: 'Tes',
                tabReminders: 'Pengingat',
                tabTips: 'Tips',
                exercisesTitle: 'Latihan Mata',
                testsTitle: 'Tes Penglihatan',
                remindersTitle: 'Pengingat Perawatan Mata',
                tipsTitle: 'Tips Kesehatan Mata',
                addReminderBtn: '+ Tambah Pengingat Baru',
                noRemindersText: 'Tidak ada pengingat yang diatur',
                snellenBtn: 'Tes Bagan Snellen',
                colorBtn: 'Tes Buta Warna',
                astigmatismBtn: 'Tes Astigmatisme',
                reminderModalTitle: 'Tambah Pengingat',
                reminderTypeLabel: 'Jenis Pengingat',
                reminderTimeLabel: 'Waktu',
                repeatDailyLabel: 'Ulangi Setiap Hari',
                addReminderModalBtn: 'Tambah Pengingat',
                deleteBtn: 'Hapus',
                startBtn: 'Mulai',
                stopBtn: 'Berhenti',
                completeBtn: 'Selesai!',
                nextBtn: 'Huruf Berikutnya',
                checkBtn: 'Periksa',
                doneBtn: 'Selesai',
                daily: 'Harian',
                exercises: {
                    '20-20-20': {
                        title: 'Aturan 20-20-20',
                        desc: 'Setiap 20 menit, lihat sesuatu 20 kaki jauhnya selama 20 detik',
                        instructions: 'Lihat objek 20 kaki jauhnya selama 20 detik. Ini membantu mengurangi ketegangan mata dari waktu layar yang lama.'
                    },
                    'palming': {
                        title: 'Palming',
                        desc: 'Rilekskan mata dengan penutupan telapak tangan yang lembut',
                        instructions: 'Gosok telapak tangan Anda bersama-sama untuk menghangatkannya, lalu letakkan dengan lembut di atas mata tertutup. Rileks selama 30 detik.'
                    },
                    'blinking': {
                        title: 'Latihan Berkedip',
                        desc: 'Berkedip sadar untuk melembabkan mata',
                        instructions: 'Berkedip perlahan dan sengaja 20 kali. Ini membantu melembabkan mata Anda secara alami.'
                    },
                    'focus-shift': {
                        title: 'Pergeseran Fokus',
                        desc: 'Fokus bergantian antara objek dekat dan jauh',
                        instructions: 'Pegang ibu jari Anda 10 inci jauhnya. Fokus selama 5 detik, lalu alihkan fokus ke sesuatu 20 kaki jauhnya selama 5 detik. Ulangi 5 kali.'
                    },
                    'eye-rolling': {
                        title: 'Memutar Mata',
                        desc: 'Gerakan mata melingkar untuk fleksibilitas',
                        instructions: 'Lihat ke atas dan perlahan putar mata Anda searah jarum jam 5 kali, kemudian berlawanan arah jarum jam 5 kali.'
                    }
                },
                tips: [
                    '💧 Jaga mata tetap terhidrasi dengan berkedip teratur',
                    '🖥️ Pertahankan jarak 20-24 inci dari layar',
                    '💡 Pastikan pencahayaan yang tepat untuk menghindari ketegangan mata',
                    '🥗 Makan makanan kaya Vitamin A dan Omega-3',
                    '😴 Dapatkan 7-8 jam tidur berkualitas',
                    '🕶️ Kenakan kacamata hitam pelindung UV di luar ruangan',
                    '💻 Sesuaikan kecerahan layar dengan lingkungan sekitar',
                    '🚭 Hindari merokok - merusak pembuluh darah mata',
                    '💊 Pertimbangkan suplemen omega-3 untuk mata kering',
                    '👩‍⚕️ Lakukan pemeriksaan mata rutin setiap tahun'
                ],
                testInstructions: {
                    snellen: 'Tutup satu mata dan identifikasi arah E',
                    color: 'Warna apa yang Anda lihat?',
                    astigmatism: 'Apakah semua garis terlihat sama gelap dan jelas?',
                    colorAlert: 'Ini adalah pemeriksaan dasar. Untuk hasil yang akurat, konsultasikan dengan spesialis mata.',
                    astigmatismAlert: 'Jika garis terlihat berbeda, konsultasikan dengan spesialis mata.'
                },
                alerts: {
                    fillFields: 'Silakan isi semua bidang',
                    exerciseComplete: 'Latihan Selesai! 🎉',
                    greatJob: 'Kerja bagus merawat mata Anda!',
                    notificationTitle: 'Pengingat Perawatan Mata'
                }
            }
        };

        // PWA Variables
        let deferredPrompt;
        let currentExercise = null;
        let exerciseTimer = null;
        let exerciseSeconds = 0;
        let reminders = [];
        let currentLang = 'en';

        // Load saved language preference
        function loadLanguagePreference() {
            const savedLang = localStorage.getItem('eyecare-language');
            if (savedLang && translations[savedLang]) {
                currentLang = savedLang;
            }
            updateLanguage();
        }

        // Toggle language dropdown
        function toggleLanguageDropdown() {
            const dropdown = document.getElementById('languageDropdown');
            dropdown.classList.toggle('show');
        }

        // Close dropdown when clicking outside
        document.addEventListener('click', (e) => {
            if (!e.target.matches('.language-selector')) {
                const dropdown = document.getElementById('languageDropdown');
                if (dropdown.classList.contains('show')) {
                    dropdown.classList.remove('show');
                }
            }
        });

        // Change language
        function changeLanguage(lang) {
            currentLang = lang;
            localStorage.setItem('eyecare-language', lang);
            updateLanguage();
            
            // Update dropdown
            document.querySelectorAll('.language-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.closest('.language-option').classList.add('active');
            
            // Close dropdown
            document.getElementById('languageDropdown').classList.remove('show');
        }

        // Update all text content based on current language
        function updateLanguage() {
            const t = translations[currentLang];
            
            // Update button text
            document.getElementById('langButton').textContent = t.code;
            
            // Update header
            document.getElementById('appTitle').textContent = t.appTitle;
            document.getElementById('appSubtitle').textContent = t.appSubtitle;
            document.getElementById('appStatus').textContent = navigator.onLine ? t.online : t.offline;
            
            // Update install banner
            document.getElementById('installText').textContent = t.installText;
            document.getElementById('installButton').textContent = t.installButton;
            
            // Update tabs
            document.getElementById('tabExercises').textContent = t.tabExercises;
            document.getElementById('tabTests').textContent = t.tabTests;
            document.getElementById('tabReminders').textContent = t.tabReminders;
            document.getElementById('tabTips').textContent = t.tabTips;
            
            // Update section titles
            document.getElementById('exercisesTitle').textContent = t.exercisesTitle;
            document.getElementById('testsTitle').textContent = t.testsTitle;
            document.getElementById('remindersTitle').textContent = t.remindersTitle;
            document.getElementById('tipsTitle').textContent = t.tipsTitle;
            
            // Update buttons
            document.getElementById('addReminderBtn').textContent = t.addReminderBtn;
            document.getElementById('snellenBtn').textContent = t.snellenBtn;
            document.getElementById('colorBtn').textContent = t.colorBtn;
            document.getElementById('astigmatismBtn').textContent = t.astigmatismBtn;
            
            // Update reminder modal
            document.getElementById('reminderModalTitle').textContent = t.reminderModalTitle;
            document.getElementById('reminderTypeLabel').textContent = t.reminderTypeLabel;
            document.getElementById('reminderTimeLabel').textContent = t.reminderTimeLabel;
            document.getElementById('repeatDailyLabel').textContent = t.repeatDailyLabel;
            document.getElementById('addReminderModalBtn').textContent = t.addReminderModalBtn;
            
            // Update no reminders text
            if (reminders.length === 0) {
                document.getElementById('noRemindersText').textContent = t.noRemindersText;
            }
            
            // Update exercises list
            renderExercises();
            
            // Update tips list
            renderTips();
            
            // Update existing reminders display
            displayReminders();
            
            // Add language class to body for font support
            document.body.className = currentLang;
        }

        // Render exercises based on current language
        function renderExercises() {
            const t = translations[currentLang];
            const exercisesList = document.getElementById('exercisesList');
            
            exercisesList.innerHTML = Object.keys(t.exercises).map(key => `
                <div class="exercise-item" onclick="startExercise('${key}')">
                    <div class="exercise-title">${t.exercises[key].title}</div>
                    <div class="exercise-desc">${t.exercises[key].desc}</div>
                </div>
            `).join('');
        }

        // Render tips based on current language
        function renderTips() {
            const t = translations[currentLang];
            const tipsList = document.getElementById('tipsList');
            
            tipsList.innerHTML = t.tips.map(tip => `<li>${tip}</li>`).join('');
        }

        // Tab Switching
        function switchTab(tab, event) {
            document.querySelectorAll('.nav-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab).classList.add('active');
        }

        // Exercise Functions
        function startExercise(type) {
            const t = translations[currentLang];
            currentExercise = {
                ...t.exercises[type],
                type: type,
                duration: type === '20-20-20' ? 20 : type === 'palming' ? 30 : type === 'blinking' ? 20 : type === 'focus-shift' ? 50 : 30
            };
            
            document.getElementById('exercise-title').textContent = currentExercise.title;
            document.getElementById('exercise-instructions').textContent = currentExercise.instructions;
            document.getElementById('timer').textContent = formatTime(currentExercise.duration);
            document.getElementById('exercise-btn').textContent = t.startBtn;
            document.getElementById('exerciseModal').classList.add('active');
            exerciseSeconds = currentExercise.duration;
        }

        function toggleExercise() {
            const t = translations[currentLang];
            const btn = document.getElementById('exercise-btn');
            
            if (btn.textContent === t.startBtn) {
                btn.textContent = t.stopBtn;
                startTimer();
            } else if (btn.textContent === t.stopBtn) {
                btn.textContent = t.startBtn;
                stopTimer();
            }
        }

        function startTimer() {
            exerciseTimer = setInterval(() => {
                exerciseSeconds--;
                document.getElementById('timer').textContent = formatTime(exerciseSeconds);
                
                if (exerciseSeconds <= 0) {
                    stopTimer();
                    completeExercise();
                }
            }, 1000);
        }

        function stopTimer() {
            if (exerciseTimer) {
                clearInterval(exerciseTimer);
                exerciseTimer = null;
            }
        }

        function completeExercise() {
            const t = translations[currentLang];
            document.getElementById('exercise-btn').textContent = t.completeBtn;
            
            // Store exercise completion
            const completions = JSON.parse(localStorage.getItem('exercise-completions') || '[]');
            completions.push({
                exercise: currentExercise.title,
                timestamp: new Date().toISOString()
            });
            localStorage.setItem('exercise-completions', JSON.stringify(completions));
            
            setTimeout(() => {
                closeExerciseModal();
            }, 2000);
            
            // Try to send notification
            if ('Notification' in window && Notification.permission === 'granted') {
                try {
                    new Notification(t.alerts.exerciseComplete, {
                        body: t.alerts.greatJob,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="70" font-size="60">👁️</text></svg>'
                    });
                } catch (e) {
                    console.log('Notification failed:', e);
                }
            }
        }

        function closeExerciseModal() {
            stopTimer();
            document.getElementById('exerciseModal').classList.remove('active');
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
        }

        // Vision Test Functions
        function startVisionTest(type) {
            const t = translations[currentLang];
            const testArea = document.getElementById('test-area');
            const testContent = document.getElementById('test-content');
            
            testArea.style.display = 'block';
            
            switch(type) {
                case 'snellen':
                    testContent.innerHTML = `
                        <div class="test-letter">E</div>
                        <p style="margin-top: 20px;">${t.testInstructions.snellen}</p>
                        <button class="btn btn-primary" onclick="nextSnellenLetter()">${t.nextBtn}</button>
                    `;
                    break;
                    
                case 'color':
                    const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24'];
                    const randomColor = colors[Math.floor(Math.random() * colors.length)];
                    testContent.innerHTML = `
                        <div style="width: 200px; height: 200px; background: ${randomColor}; margin: 0 auto; border-radius: 50%;"></div>
                        <p style="margin-top: 20px;">${t.testInstructions.color}</p>
                        <button class="btn btn-primary" onclick="alert('${t.testInstructions.colorAlert}')">${t.checkBtn}</button>
                    `;
                    break;
                    
                case 'astigmatism':
                    testContent.innerHTML = `
                        <svg width="200" height="200" style="margin: 20px auto; display: block;">
                            <g transform="translate(100,100)">
                                ${Array.from({length: 12}, (_, i) => {
                                    const angle = i * 30;
                                    return `<line x1="0" y1="0" x2="80" y2="0" stroke="black" stroke-width="2" transform="rotate(${angle})"/>`;
                                }).join('')}
                            </g>
                        </svg>
                        <p>${t.testInstructions.astigmatism}</p>
                        <button class="btn btn-primary" onclick="alert('${t.testInstructions.astigmatismAlert}')">${t.doneBtn}</button>
                    `;
                    break;
            }
        }

        function nextSnellenLetter() {
            const letters = ['E', 'F', 'P', 'T', 'O', 'Z'];
            const randomLetter = letters[Math.floor(Math.random() * letters.length)];
            document.querySelector('.test-letter').textContent = randomLetter;
        }

        // Reminder Functions
        function showReminderModal() {
            document.getElementById('reminderModal').classList.add('active');
        }

        function closeReminderModal() {
            document.getElementById('reminderModal').classList.remove('active');
        }

        function addReminder() {
            const t = translations[currentLang];
            const type = document.getElementById('reminder-type').value;
            const time = document.getElementById('reminder-time').value;
            const repeat = document.getElementById('reminder-repeat').checked;
            
            if (!type || !time) {
                alert(t.alerts.fillFields);
                return;
            }
            
            const reminder = {
                id: Date.now(),
                type,
                time,
                repeat
            };
            
            reminders.push(reminder);
            saveReminders();
            displayReminders();
            closeReminderModal();
            
            // Clear form
            document.getElementById('reminder-type').value = '';
            document.getElementById('reminder-time').value = '';
            document.getElementById('reminder-repeat').checked = false;
            
            // Schedule notification
            scheduleNotification(reminder);
        }

        function displayReminders() {
            const t = translations[currentLang];
            const list = document.getElementById('reminders-list');
            
            if (reminders.length === 0) {
                list.innerHTML = `<p style="text-align: center; color: #7f8c8d;">${t.noRemindersText}</p>`;
                return;
            }
            
            list.innerHTML = reminders.map(r => `
                <div class="reminder-item">
                    <div class="reminder-info">
                        <div class="reminder-time">${r.time} ${r.repeat ? `(${t.daily})` : ''}</div>
                        <div class="reminder-text">${r.type}</div>
                    </div>
                    <button class="delete-btn" onclick="deleteReminder(${r.id})">${t.deleteBtn}</button>
                </div>
            `).join('');
        }

        function deleteReminder(id) {
            reminders = reminders.filter(r => r.id !== id);
            saveReminders();
            displayReminders();
        }

        function saveReminders() {
            localStorage.setItem('eyecare-reminders', JSON.stringify(reminders));
        }

        function loadReminders() {
            const saved = localStorage.getItem('eyecare-reminders');
            if (saved) {
                reminders = JSON.parse(saved);
                displayReminders();
                // Reschedule all reminders
                reminders.forEach(r => scheduleNotification(r));
            }
        }

        function scheduleNotification(reminder) {
            const t = translations[currentLang];
            if ('Notification' in window && Notification.permission === 'granted') {
                const [hours, minutes] = reminder.time.split(':');
                const now = new Date();
                const scheduledTime = new Date();
                scheduledTime.setHours(parseInt(hours));
                scheduledTime.setMinutes(parseInt(minutes));
                scheduledTime.setSeconds(0);
                
                if (scheduledTime <= now) {
                    // If time has passed today, schedule for tomorrow
                    scheduledTime.setDate(scheduledTime.getDate() + 1);
                }
                
                const timeout = scheduledTime - now;
                
                setTimeout(() => {
                    try {
                        new Notification(t.alerts.notificationTitle, {
                            body: reminder.type,
                            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y="70" font-size="60">👁️</text></svg>'
                        });
                    } catch (e) {
                        console.log('Notification failed:', e);
                    }
                    
                    if (reminder.repeat) {
                        // Reschedule for next day
                        scheduleNotification(reminder);
                    }
                }, timeout);
            }
        }

        // PWA Installation
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installBanner').classList.add('show');
        });

        function promptInstall() {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                deferredPrompt.userChoice.then((choiceResult) => {
                    if (choiceResult.outcome === 'accepted') {
                        console.log('PWA installed');
                        document.getElementById('installBanner').classList.remove('show');
                    }
                    deferredPrompt = null;
                });
            }
        }

        // Check if app is installed
        window.addEventListener('appinstalled', () => {
            document.getElementById('installBanner').classList.remove('show');
        });

        // Update online/offline status
        function updateOnlineStatus() {
            const t = translations[currentLang];
            const status = document.getElementById('appStatus');
            if (navigator.onLine) {
                status.textContent = t.online;
                status.style.background = '#e8f5e9';
                status.style.color = '#2e7d32';
            } else {
                status.textContent = t.offline;
                status.style.background = '#ffebee';
                status.style.color = '#c62828';
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);

        // Request Notification Permission
        if ('Notification' in window && Notification.permission === 'default') {
            setTimeout(() => {
                Notification.requestPermission().then(permission => {
                    if (permission === 'granted') {
                        console.log('Notifications enabled');
                    }
                });
            }, 3000); // Ask after 3 seconds
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            loadLanguagePreference();
            loadReminders();
            updateOnlineStatus();
            
            // Check if running as installed PWA
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('Running as installed PWA');
            }
        });
    </script>
</body>
</html>
